<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bet: Pangea-Bet</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Bet"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bet
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,true,'search.php','Search');
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d3/dcc/md__r_e_a_d_m_e.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Pangea-Bet </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The aim of this project is to provide the necessary bet API's which are sufficient to play poker from the command line. The initial draft of the game written by jl777 is here.</p>
<p>Bet is the implementation of the Pangea protocol which nees LN and CHIPS. The installation of <a href="https://github.com/chips-blockchain/lightning">LN</a> and <a href="https://github.com/chips-blockchain/chips">CHIPS</a> must be done before proceeding to play with bet.</p>
<p>If you would like to learn more please refer to the <a href="https://cdn.discordapp.com/attachments/455737840668770315/456036359870611457/Unsolicited_PANGEA_WP.pdf">Pangea Protocol Whitepaper</a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
The game</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
Terms</h2>
<p><code>CHIPS</code> - game token and the name of the poker project</p>
<p><code>DCV</code> - Deck Creating Vendor, the Dealer node</p>
<p><code>BVV</code> - Blinding Value Vendor, the component that helps securely shuffle the deck</p>
<p><code>Cashier</code> or <code>Notary</code> nodes - Trusted nodes in the network that are elcted and chosen by the community. The set of trusted nodes at the moment are <a href="https://github.com/chips-blockchain/bet/blob/master/privatebet/config/cashier_nodes.json">here</a>.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Node Communication</h2>
<p>All the communication in the game must happen though <code>DCV</code>. Pangea Protocol does not allow any direct communication between the Players and the <code>BVV</code>. Players and <code>BVV</code> connect to <code>DCV</code> via <code>NN_PUSH/NN_PULL</code> socket. If any entity in the game is willing to send a message, it sends it to <code>DCV</code> via <code>NN_PUSH</code>, and <code>DCV</code> receives it via <code>NN_PULL</code>.</p>
<p><img src="../../assets/PULL.png" alt="" width="500" class="inline"/></p>
<p>Once the <code>DCV</code> receives the messages it publishes it via <code>NN_PUB</code> and since Players and <code>BVV</code> are subscribed to <code>DCV</code> via <code>NN_SUB</code> so whenever the <code>DCV</code> publishes messages the Players and <code>BVV</code> receive it.</p>
<p><img src="../../assets/Messages.png" alt="" width="500" class="inline"/></p>
<p>Source: Pangea Protocol Whitepaper (authors: <a href="https://github.com/sg777">sg777</a>, <a href="https://github.com/jl777/">jl777</a>)</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Installation</h1>
<blockquote class="doxtable">
<p>Note: You will need an exposed IP to play the game </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md5"></a>
Ports to be used and open</h2>
<p>Below are the list of the ports used and should be remained open incase if you have any firewall configurations. </p><div class="fragment"><div class="line">* 7797 - This port is used to have pub-sub communication between Dealer and player nodes.</div>
<div class="line">* 7798 - This port is used to have pull-push communication between Dealer and player nodes.</div>
<div class="line">* 7901 - This port is used to have pub-sub communication between Cashier and any other{player,dealer} nodes.</div>
<div class="line">* 7902 - This port is used to have push-pull communication between Cashier and any other{player,dealer} nodes.</div>
<div class="line">* 9000 - This port is used to have websocket communication between GUI and {player,dealer} nodes.</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
Compilation Guidelines</h2>
<p>Install Dependencies:</p>
<div class="fragment"><div class="line">sudo apt-get update</div>
<div class="line">sudo apt-get install -y \</div>
<div class="line">  autoconf automake build-essential git libtool libgmp-dev \</div>
<div class="line">  libsqlite3-dev python3 net-tools zlib1g-dev libsodium-dev \</div>
<div class="line">  gettext wget libcurl3-gnutls ninja-build libssl-dev \</div>
<div class="line">  libcurl4-gnutls-dev libevent-dev</div>
</div><!-- fragment --><p>Then clone this repo and build the binaries</p>
<div class="fragment"><div class="line">git clone https://github.com/chips-blockchain/bet</div>
<div class="line">cd bet</div>
<div class="line">./configure</div>
<div class="line">make</div>
</div><!-- fragment --><p>Steps to compile this repo and all the other required dependencies to play Pangea Poker are mentioned in compile.md.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Docker Setup</h2>
<p>The node set up can also be done <a href="https://github.com/chips-blockchain/docker">using Docker</a>.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Running the game</h1>
<h2><a class="anchor" id="autotoc_md9"></a>
Command to run DCV</h2>
<div class="fragment"><div class="line">$ cd ~/bet/privatebet</div>
<div class="line">$ ./bet dcv &lt;dealer_ip&gt;</div>
</div><!-- fragment --><p> The <code>dealer_ip</code> should be a <code>static public ip</code> of a machine on which a dealer node runs.</p>
<h3><a class="anchor" id="autotoc_md10"></a>
Configuring the Table</h3>
<p>The dealer can configure the table parameters, the steps to configure the table parameters are mentioned <a class="el" href="../../dc/d29/configure__dealer_8md.html">here</a>.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Command to run Player</h2>
<div class="fragment"><div class="line">$ cd</div>
<div class="line">$ cd bet/privatebet</div>
<div class="line">$ ./bet player</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md12"></a>
Command to run Cashier</h2>
<div class="fragment"><div class="line">$ cd</div>
<div class="line">$ cd bet/privatebet</div>
<div class="line">$ ./cashierd cashier cashier_ip</div>
</div><!-- fragment --><p> The <code>cashier_ip</code> should be a <code>static public ip</code> of a machine on which a cashier node runs. The cashier nodes are the trusted nodes in the network and are elcted and chosen by the community. The set of trusted nodes at the moment are <a href="../.././privatebet/config/cashier_nodes.json">here</a>.</p>
<p>To avoid the unavailability of the nodes due to any crahing and disconnections, the cashier daemons are scheduled using crontab. The contents of the shell script which is scheduled using the crontab is as follows: </p><div class="fragment"><div class="line">#!/bin/bash</div>
<div class="line">SERVICE=&quot;cashierd&quot;</div>
<div class="line">date</div>
<div class="line">if pgrep -x &quot;$SERVICE&quot; &gt;/dev/null</div>
<div class="line">then</div>
<div class="line">    echo &quot;$SERVICE is running&quot;</div>
<div class="line">else</div>
<div class="line">    echo &quot;$SERVICE stopped&quot;</div>
<div class="line">    cd /root/bet/privatebet</div>
<div class="line">    ./cashierd cashier &lt;ip_addr&gt;</div>
<div class="line">fi</div>
</div><!-- fragment --><p> Using <code>crontab -e</code> one can edit the crontab file and schedule it run all the time by adding the following line at the end of cron file <br  />
<code>* * * * * /root/cron.sh</code>.<br  />
 Here <code>cron.sh</code> contains the above shell commands and replace <code>&lt;ip_addr&gt;</code> with the static public ipv4 address of the node where this daemon is running.</p>
<p>The detailed description of the cashier protocol is mentioned <a class="el" href="../../d7/da0/cashier__protocol_8md.html">here</a>.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Usage of this repo</h1>
<p>The usage of this repo varies from branch to branch. Each branch has a different gaming logic and their intended gameplays are different.</p>
<p>The branches are listes as follow.</p><ul>
<li>master</li>
<li>highest_card_wins</li>
<li>poker</li>
<li>mp_cli</li>
<li>rest_dev</li>
<li>poker_test</li>
</ul>
<h2><a class="anchor" id="autotoc_md14"></a>
master</h2>
<p>The implementation of poker using the GUI has been implemented here.</p>
<h2><a class="anchor" id="autotoc_md15"></a>
highest_card_wins</h2>
<p>This branch is used to play the highest card player wins game via CLI, two players can play the game. The player whoever gets the highest card wins the game.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
poker</h2>
<p>This branch is used to player poker via CLI</p>
<h2><a class="anchor" id="autotoc_md17"></a>
mp_cli</h2>
<p>In this branch implementation is done to support more than two players, and also made a provision to pass the number of players from the command line</p>
<h2><a class="anchor" id="autotoc_md18"></a>
rest_dev</h2>
<p>This branch is used to player poker via GUI, the GUI code should be taken from <code>poker</code> branch of <code>[pangea-poker-frontend](<a href="https://github.com/sg777/pangea-poker-frontend">https://github.com/sg777/pangea-poker-frontend</a>)</code> repo.</p>
<p>For the GUI developers the backend message formats are defined here</p>
<h2><a class="anchor" id="autotoc_md19"></a>
poker_test</h2>
<p>This branch is used to player poker via GUI, the GUI code should be taken from <code>poker_test</code> branch of <code>[pangea-poker-frontend](<a href="https://github.com/sg777/pangea-poker-frontend">https://github.com/sg777/pangea-poker-frontend</a>)</code> repo.</p>
<h2><a class="anchor" id="autotoc_md20"></a>
LN Upgrade</h2>
<p>Since bet uses the lightning network for the real time payments, so its necessary for the CHIPS LN node to be sync with upstream lightning network. As we seen the changes in the input and output of LN API's in the upstream we should be cautious about porting those changes into the CHIPS LN node. The LN commands that bet uses at the moment during the process of the game are listed below: </p><div class="fragment"><div class="line">getinfo</div>
<div class="line">fundchannel</div>
<div class="line">pay</div>
<div class="line">connect</div>
<div class="line">listfunds</div>
<div class="line">invoice</div>
<div class="line">dev-blockheight</div>
<div class="line">peer-channel-state</div>
<div class="line">listpeers</div>
<div class="line">newaddr</div>
</div><!-- fragment --><p> So we should test the functiolities of these API's to see any changes are made everytime when we port something to the downstream CHIPS LN node. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Jul 22 2021 18:33:23 for Bet by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
